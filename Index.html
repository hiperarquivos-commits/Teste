<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clone iFood Avançado com Mapa</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body class="bg-gray-100 font-sans">

<!-- TOPO -->
<header class="bg-red-600 text-white p-4 flex justify-between items-center fixed w-full top-0 z-50">
  <h1 class="text-2xl font-bold">Clone iFood</h1>
  <input type="text" id="search" placeholder="Buscar restaurantes..." 
         class="p-2 rounded text-black w-1/2" oninput="filterRestaurants()">
</header>

<main class="pt-24">

  <!-- Categorias -->
  <section class="p-4">
    <h2 class="text-xl font-semibold mb-2">Categorias</h2>
    <div id="categories" class="flex gap-4 overflow-x-auto pb-2"></div>
  </section>

  <!-- Restaurantes -->
  <section class="p-4">
    <h2 class="text-xl font-semibold mb-2">Restaurantes</h2>
    <div id="restaurants" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
  </section>

  <!-- Cardápio + Mapa -->
  <section id="menu-section" class="p-4 hidden">
    <h2 id="menu-title" class="text-xl font-bold mb-4"></h2>
    <div id="menu-items" class="grid gap-2 mb-4"></div>
    <div id="map" class="h-48 w-full rounded shadow mb-4"></div>
    <button class="mt-4 bg-gray-500 text-white px-4 py-2 rounded" onclick="closeMenu()">Voltar</button>
  </section>

</main>

<!-- Carrinho -->
<section class="fixed bottom-4 right-4 bg-white p-4 rounded shadow w-80 max-w-full" id="cart">
  <h2 class="font-bold text-lg mb-2">Carrinho</h2>
  <ul id="cart-items" class="mb-2"></ul>
  <p>Total: R$ <span id="cart-total">0.00</span></p>
  <button class="bg-green-600 text-white px-4 py-2 rounded mt-2 w-full" onclick="checkout()">Finalizar Pedido</button>
  <p id="order-status" class="mt-2 text-sm text-gray-600"></p>
</section>

<script>
// Dados de exemplo com localização (lat/lng simuladas)
const restaurantsData = [
  { id: 1, name: "Lanchonete Express", category: "Lanches", lat: -23.5505, lng: -46.6333,
    products: [{ id: 101, name: "X-Burguer", price: 15.0 }, { id: 102, name: "Batata Frita", price: 8.0 }] },
  { id: 2, name: "Sushi House", category: "Japonesa", lat: -23.5510, lng: -46.6340,
    products: [{ id: 201, name: "Sushi Mix", price: 40.0 }, { id: 202, name: "Temaki", price: 20.0 }] },
  { id: 3, name: "Pizza Mania", category: "Pizza", lat: -23.5520, lng: -46.6350,
    products: [{ id: 301, name: "Pizza Calabresa", price: 35.0 }, { id: 302, name: "Pizza Mussarela", price: 30.0 }] }
];

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let map, restaurantMarker;

function renderCategories() {
  const container = document.getElementById("categories");
  const categories = [...new Set(restaurantsData.map(r => r.category))];
  container.innerHTML = '';
  categories.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "bg-white px-4 py-2 rounded shadow";
    btn.textContent = cat;
    btn.onclick = () => filterByCategory(cat);
    container.appendChild(btn);
  });
}

function renderRestaurants(restaurants) {
  const container = document.getElementById("restaurants");
  container.innerHTML = "";
  restaurants.forEach(r => {
    const card = document.createElement("div");
    card.className = "bg-white p-4 rounded shadow transition transform hover:scale-105";
    card.innerHTML = `
      <h3 class="font-bold text-lg mb-1">${r.name}</h3>
      <p class="text-gray-600 mb-2">${r.category}</p>
      <button class="bg-red-600 text-white px-2 py-1 rounded" onclick="viewMenu(${r.id})">Ver Cardápio</button>
    `;
    container.appendChild(card);
  });
}

function filterByCategory(cat) {
  renderRestaurants(restaurantsData.filter(r => r.category === cat));
}

function filterRestaurants() {
  const query = document.getElementById("search").value.toLowerCase();
  renderRestaurants(restaurantsData.filter(r => r.name.toLowerCase().includes(query)));
}

function viewMenu(id) {
  const restaurant = restaurantsData.find(r => r.id === id);
  document.getElementById("restaurants").parentElement.style.display = "none";
  document.getElementById("menu-section").classList.remove("hidden");
  document.getElementById("menu-title").textContent = `${restaurant.name} - Cardápio`;

  const menuContainer = document.getElementById("menu-items");
  menuContainer.innerHTML = "";
  restaurant.products.forEach(p => {
    const item = document.createElement("div");
    item.className = "bg-white p-2 rounded shadow mb-2 flex justify-between items-center";
    item.innerHTML = `
      <span>${p.name} - R$ ${p.price.toFixed(2)}</span>
      <div class="flex gap-2 items-center">
        <input type="number" id="qty-${p.id}" min="1" value="1" class="w-12 p-1 border rounded text-black">
        <button class="bg-green-600 text-white px-2 py-1 rounded" onclick="addToCart(${p.id}, ${p.price}, '${p.name}')">Adicionar</button>
      </div>
    `;
    menuContainer.appendChild(item);
  });

  // Inicializar mapa
  if(!map){
    map = L.map('map').setView([restaurant.lat, restaurant.lng], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map);
  }
  if(restaurantMarker) map.removeLayer(restaurantMarker);
  restaurantMarker = L.marker([restaurant.lat, restaurant.lng]).addTo(map)
    .bindPopup(`${restaurant.name}`).openPopup();
}

function closeMenu(){
  document.getElementById("menu-section").classList.add("hidden");
  document.getElementById("restaurants").parentElement.style.display = "block";
}

function addToCart(id, price, name){
  const qty = parseInt(document.getElementById(`qty-${id}`).value);
  const existing = cart.find(item => item.id === id);
  if(existing){
    existing.qty += qty;
  } else {
    cart.push({ id, price, name, qty });
  }
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function renderCart(){
  const list = document.getElementById("cart-items");
  const totalEl = document.getElementById("cart-total");
  list.innerHTML = "";
  let total = 0;
  cart.forEach((item, index) => {
    total += item.price * item.qty;
    const li = document.createElement("li");
    li.className = "flex justify-between mb-1";
    li.innerHTML = `
      <span>${item.name} x${item.qty} - R$ ${(item.price*item.qty).toFixed(2)}</span>
      <button class="text-red-600 font-bold" onclick="removeFromCart(${index})">X</button>
    `;
    list.appendChild(li);
  });
  totalEl.textContent = total.toFixed(2);
}

function removeFromCart(index){
  cart.splice(index,1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function checkout(){
  if(cart.length===0){
    alert("Seu carrinho está vazio!");
    return;
  }
  document.getElementById("order-status").textContent = "Pedido recebido! Preparando...";
  setTimeout(()=>document.getElementById("order-status").textContent="Pedido a caminho!",3000);
  setTimeout(()=>document.getElementById("order-status").textContent="Pedido entregue!",6000);
  cart.length=0;
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

renderCategories();
renderRestaurants(restaurantsData);
renderCart();

</script>
</body>
</html>
